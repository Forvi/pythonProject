<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{path.name}}</title>

    <link rel="stylesheet" href="{% static 'css/main_style.css' %}">
    <link rel="stylesheet" href="{% static 'css/path.css' %}">

</head>
<body>

<header id="header" class="header">
    <div class="container header__container">
        <a href="/main" class="logo" id="logo">
            <svg width="105" height="22" viewBox="0 0 105 22" fill="white" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M35 10.5417C35 4.71967 39.9249 0 46 0C52.0751 0 57 4.71967 57 10.5417V11.4583C57 17.2803 52.0751 22 46 22C39.9249 22 35 17.2803 35 11.4583V10.5417ZM48.0223 18.5823C50.9075 18.8696 53.3743 16.6114 53.2068 13.8362C53.1849 13.4745 53.1177 13.1166 53.0065 12.7703L51.3896 7.73416C51.3042 7.46844 51.2609 7.19198 51.2609 6.91396C51.2609 5.37366 49.9579 4.125 48.3507 4.125H46.4183C46.14 4.125 45.8606 4.10175 45.5864 4.05601C42.1056 3.47538 39.0318 6.33623 39.5705 9.68258L39.6521 10.1892C39.7386 10.7266 39.7386 11.2735 39.6521 11.8108L39.4716 12.9317C38.9699 16.0481 41.7057 18.7649 44.9734 18.3954C45.3378 18.3541 45.7059 18.3517 46.071 18.388L48.0223 18.5823Z"/>
                <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M83 10.5417C83 4.71967 87.9249 0 94 0C100.075 0 105 4.71967 105 10.5417V11.4583C105 17.2803 100.075 22 94 22C87.9249 22 83 17.2803 83 11.4583V10.5417ZM96.0223 18.5823C98.9075 18.8696 101.374 16.6114 101.207 13.8362C101.185 13.4745 101.118 13.1166 101.007 12.7703L99.3896 7.73416C99.3042 7.46844 99.2609 7.19198 99.2609 6.91396C99.2609 5.37366 97.9579 4.125 96.3506 4.125H94.4183C94.14 4.125 93.8606 4.10175 93.5864 4.05601C90.1056 3.47538 87.0318 6.33623 87.5705 9.68258L87.6521 10.1892C87.7386 10.7266 87.7386 11.2735 87.6521 11.8108L87.4716 12.9317C86.9699 16.0481 89.7057 18.7649 92.9734 18.3954C93.3378 18.3541 93.7059 18.3517 94.071 18.388L96.0223 18.5823Z"/>
                <path d="M61.969 0C59.8207 0 58.3852 2.19724 59.261 4.14489L65.9851 19.0983C66.7788 20.8633 68.5436 22 70.4905 22C72.4374 22 74.2022 20.8633 74.9959 19.0983L81.7421 4.0958C82.6075 2.17122 81.189 0 79.0662 0C77.6412 0 76.4227 1.01777 76.1789 2.41175L73.8484 15.735C73.7575 16.2547 73.3032 16.6341 72.7719 16.6341H68.7969C68.258 16.6341 67.793 16.2588 67.6831 15.735L64.8722 2.34375C64.5857 0.978426 63.3737 0 61.969 0Z"/>
                <path d="M5.5 19.25C5.5 20.7688 4.26878 22 2.75 22C1.23122 22 0 20.7688 0 19.25V3.27381C0 1.75503 1.23122 0.52381 2.75 0.52381H4.73619C5.15803 0.52381 5.5 0.865779 5.5 1.28762C5.5 2.03027 6.45257 2.3361 6.88487 1.73224L7 1.57143C7.5 1.04762 8.7 0 9.5 0H14L15.0942 1.00303C16.7922 2.55954 19.3433 2.72852 21.2317 1.40958C22.0573 0.833 23.04 0.52381 24.047 0.52381H26.2777C27.4048 0.52381 28.5107 0.829548 29.4778 1.40845C30.7809 2.18854 31.7541 3.41775 32.2146 4.865L32.5635 5.96156C32.8528 6.87063 33 7.8189 33 8.77287V19.5C33 20.8807 31.8807 22 30.5 22C29.1193 22 28 20.8807 28 19.5V10.0739C28 8.99641 27.5421 7.96975 26.7404 7.24988C25.4282 6.07158 23.4772 5.9524 22.0314 6.96221L21.7845 7.13466C20.6662 7.91564 20 9.19359 20 10.5575V19C20 20.6569 18.6569 22 17 22C15.3431 22 14 20.6569 14 19V10.5031C14 9.16326 13.3849 7.89762 12.3313 7.06986L12.2169 6.97991C10.8786 5.92845 9.03425 5.80017 7.56336 6.65624C6.28586 7.39976 5.5 8.76642 5.5 10.2445V19.25Z"/>
            </svg>
        </a>
        <nav class="menu">
            <ul class="menu__list">
                <li class="menu__item">
                    <a class="menu__link" href="profile">
                        <div>
                            <img class="avatar" src="{% if author_id.avatar %}{{ author_id.avatar.url }}{% else %}{% static 'default.png' %}{% endif %}">
                        </div>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<main>
    <div class="path">

        <img class="image_path" src="{{ path.hotel_Main_Img.url }}">
        <h1 class="path_name">{{ path.name }}</h1>
        <p class="path_date">{{ path.date }}</p>
        <p class="path_autor">{{ path.author.login }}</p>
        <p class="path_length">{{ path.length }} км</p>
        <p class="path_comm">{{ path.count_comment }}<img src="{% static 'sprite/comm.svg' %}"></p>
        <p class="path_fav">{{ path.count_product }} <img src="{% static 'sprite/icn_heart.svg' %}"></p>
        {% if path.author.pk == author_id.pk %}
        <div class="redirect" onclick="document.location='{% url 'Redact' path.pk %}'">
            <img src="{% static 'sprite/icn_redactor.svg' %}">
        </div>
        {% endif %}

        <p class="path_main_text">{{ path.text }}</p>

        <p id="path_pk" style="display:none;">{{ path.pk }}</p>

        <div id="myMap" class="map"></div>

    </div>

    <div class="comment">
        <textarea placeholder="Введите комментарий"
                  style="width:99.5%;background-color:#F5F5F5;border:0;border-bottom: solid #B6B6B6;"
                  id="text_comment"></textarea>
        <div><a class="custom-button" href="#" onclick="create_comment({{ path.pk }})">Добавить комментарий</a></div>
        <p id="comment_error-mesage"></p>
        {% if comment|length != 0 %}
        {% for i in comment %}
        <div style="height:35%;">
            <img class="avatar_user_comm"
                 src="{% if i.author.avatar %}{{ i.author.avatar.url }}{% else %}{% static 'default.jpg' %}{% endif %}">
            <p class="user_login"><b>{{ i.author.login }}</b></p>
            <p class="user_text">{{ i.text }}</p>
            <p class="user_date">{{ i.date }}</p>
        </div>

        {% endfor %}
        {% endif %}

    </div>
</main>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=27dc3277-8092-4403-8242-2c889ecbf239&load=package.controls,package.geoObjects"
        type="text/javascript"></script>
<script src="{% static 'script/header_animation.js' %}"></script>

<script>
    ymaps.ready(init);

    async function init() {
        let path_id = document.getElementById('path_pk').textContent;
        const res = await fetch(`/get_coords/${path_id}`).then(res => res.json());
        var myMap = new ymaps.Map('myMap', {
            center: [res.center_x, res.center_y], //координаты центра
            zoom: 13 //уровень приближения
        });
        let route = ymaps.route([
            [res.x1, res.y1],

            [res.x2, res.y2]
        ]).then(
            function (route) {
                myMap.geoObjects.add(route);

                var routeLength = route.getLength(); // Длина маршрута
                var firstPath = route.getPaths().get(0); // Первый путь

                var firstPathLength = firstPath.getLength(); // Длина первого пути
                var firtstPathTime = firstPath.getTime(); // Время без учета пробок
                var firstPathFirstSegment = firstPath.getSegments()[0];// Первый сегмент первого пути
                var firstPathFirstSegmentJamsTime = firstPathFirstSegment.getJamsTime();// Время с пробками

            },
            function (error) {
                alert("Возникла ошибка: " + error.message);
            },
        );
    }
</script>

<script>
    create_comment = async (pk) => {
        const error_message = document.getElementById('comment_error-mesage')
        const text = document.getElementById('text_comment');
        if (text.value.length != 0) {
            const res = await fetch(`/create_comment/${pk}?text_comment=${text.value}`).then(res => res.json());
            location.reload();
        } else {
            error_message.innerHTML = "Комментарий не может быть пустым";
        }
    }
</script>

</body>
</html>