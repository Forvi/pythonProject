<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>movo</title>
    <link rel="stylesheet" href="{% static 'css/main_style.css' %}">
</head>
<body>

<header id="header" class="header">
    <div class="container header__container">
        <a href="/main" class="logo" id="logo">
            <svg width="105" height="22" viewBox="0 0 105 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M35 10.5417C35 4.71967 39.9249 0 46 0C52.0751 0 57 4.71967 57 10.5417V11.4583C57 17.2803 52.0751 22 46 22C39.9249 22 35 17.2803 35 11.4583V10.5417ZM48.0223 18.5823C50.9075 18.8696 53.3743 16.6114 53.2068 13.8362C53.1849 13.4745 53.1177 13.1166 53.0065 12.7703L51.3896 7.73416C51.3042 7.46844 51.2609 7.19198 51.2609 6.91396C51.2609 5.37366 49.9579 4.125 48.3507 4.125H46.4183C46.14 4.125 45.8606 4.10175 45.5864 4.05601C42.1056 3.47538 39.0318 6.33623 39.5705 9.68258L39.6521 10.1892C39.7386 10.7266 39.7386 11.2735 39.6521 11.8108L39.4716 12.9317C38.9699 16.0481 41.7057 18.7649 44.9734 18.3954C45.3378 18.3541 45.7059 18.3517 46.071 18.388L48.0223 18.5823Z"
                      fill="white"/>
                <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M83 10.5417C83 4.71967 87.9249 0 94 0C100.075 0 105 4.71967 105 10.5417V11.4583C105 17.2803 100.075 22 94 22C87.9249 22 83 17.2803 83 11.4583V10.5417ZM96.0223 18.5823C98.9075 18.8696 101.374 16.6114 101.207 13.8362C101.185 13.4745 101.118 13.1166 101.007 12.7703L99.3896 7.73416C99.3042 7.46844 99.2609 7.19198 99.2609 6.91396C99.2609 5.37366 97.9579 4.125 96.3506 4.125H94.4183C94.14 4.125 93.8606 4.10175 93.5864 4.05601C90.1056 3.47538 87.0318 6.33623 87.5705 9.68258L87.6521 10.1892C87.7386 10.7266 87.7386 11.2735 87.6521 11.8108L87.4716 12.9317C86.9699 16.0481 89.7057 18.7649 92.9734 18.3954C93.3378 18.3541 93.7059 18.3517 94.071 18.388L96.0223 18.5823Z"
                      fill="white"/>
                <path d="M61.969 0C59.8207 0 58.3852 2.19724 59.261 4.14489L65.9851 19.0983C66.7788 20.8633 68.5436 22 70.4905 22C72.4374 22 74.2022 20.8633 74.9959 19.0983L81.7421 4.0958C82.6075 2.17122 81.189 0 79.0662 0C77.6412 0 76.4227 1.01777 76.1789 2.41175L73.8484 15.735C73.7575 16.2547 73.3032 16.6341 72.7719 16.6341H68.7969C68.258 16.6341 67.793 16.2588 67.6831 15.735L64.8722 2.34375C64.5857 0.978426 63.3737 0 61.969 0Z"
                      fill="white"/>
                <path d="M5.5 19.25C5.5 20.7688 4.26878 22 2.75 22C1.23122 22 0 20.7688 0 19.25V3.27381C0 1.75503 1.23122 0.52381 2.75 0.52381H4.73619C5.15803 0.52381 5.5 0.865779 5.5 1.28762C5.5 2.03027 6.45257 2.3361 6.88487 1.73224L7 1.57143C7.5 1.04762 8.7 0 9.5 0H14L15.0942 1.00303C16.7922 2.55954 19.3433 2.72852 21.2317 1.40958C22.0573 0.833 23.04 0.52381 24.047 0.52381H26.2777C27.4048 0.52381 28.5107 0.829548 29.4778 1.40845C30.7809 2.18854 31.7541 3.41775 32.2146 4.865L32.5635 5.96156C32.8528 6.87063 33 7.8189 33 8.77287V19.5C33 20.8807 31.8807 22 30.5 22C29.1193 22 28 20.8807 28 19.5V10.0739C28 8.99641 27.5421 7.96975 26.7404 7.24988C25.4282 6.07158 23.4772 5.9524 22.0314 6.96221L21.7845 7.13466C20.6662 7.91564 20 9.19359 20 10.5575V19C20 20.6569 18.6569 22 17 22C15.3431 22 14 20.6569 14 19V10.5031C14 9.16326 13.3849 7.89762 12.3313 7.06986L12.2169 6.97991C10.8786 5.92845 9.03425 5.80017 7.56336 6.65624C6.28586 7.39976 5.5 8.76642 5.5 10.2445V19.25Z"
                      fill="white"/>
            </svg>
        </a>
        <nav class="menu">
            <ul class="menu__list">
                <li class="menu__item">
                    <a class="menu__link" href="#">
                        <img src="{% static 'sprite/black_heart.svg' %}">
                    </a>
                </li>
                <li class="menu__item">
                    <a class="menu__link" href="#">
                       <img class="avatar" src="{{ user.avatar.url }}">
                        <div class="avatar-name"></div>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<div class="video-bg">
    <div class="imageblock"></div>
    <div class="effects"></div>
    <div class="video-bg__content">
        <h1>«Маршрутная книга» по Екатеринбургу</h1>
        <p>Лучшие места города от лица жителей</p>

        <button id="createpath" class="create_button">
            Создать путь
        </button>
        <p id="error-message"></p>
    </div>
</div>

    <div class="main_content">
        <h1 class="main_header">Популярные маршруты</h1>
        <div class="card_container">
            <div class="path_container">
                {% for path in paths %}
                <div class="path_card">
                    <div class="path_item" onclick="document.location='{% url 'path' path.pk %}'">
                        <img src="{{ path.hotel_Main_Img.url }}" alt="Hotel Image">
                        <div class="card_info">
                            <div>
                                <h1 class="card_name cardName_text">{{ path.name }}</h1>
                                <p class="card_length">{{ path.length }} км</p>
                            </div>
                        </div>
                    </div>
                    <div class="likes_container" onclick="addfavorite({{ path.pk }})">
                        <svg width="20" height="19" viewBox="0 0 20 19" fill="#F21832"
                             xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                  d="M13.4852 0.0934125C17.2886 -0.678974 20.44 3.48938 19.9318 7.0305C19.1984 12.1403 13.5035 15.2626 9.99288 18.3179C6.48225 15.2626 0.787314 12.1403 0.0539839 7.0305C-0.454221 3.48938 2.69711 -0.678974 6.5006 0.0934128C7.77356 0.351918 8.96471 1.0763 9.99287 1.94325C11.021 1.0763 12.2122 0.351918 13.4852 0.0934125Z"/>
                        </svg>
                        <p class="info_likes">{{ path.count_product }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        function longText() {
            let textElements = document.getElementsByClassName("cardName_text");

            for (let textElement of textElements) {
                let text = textElement.innerText;

                if (text.length > 20) {
                    let cutText = text.substring(0, 20) + "...";
                    textElement.innerText = cutText;
                }
            }
        }

        longText();

        addfavorite = async (pk) => {
            event.stopPropagation();
            const res = await fetch(`/add_fav/${pk}`).then(res => res.json());
            location.reload();
        }

        $(document).ready(function () {
            $("#createpath").click(function () {
                $.ajax({
                    type: "POST",
                    url: "/check_user/",
                    data: {
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function (response) {
                        if (response.is_authenticated) {
                            window.location.href = "/redactor";
                        } else {
                            let errorMessageParagraph = document.getElementById("error-message");
                            errorMessageParagraph.textContent = response.error_message;
                        }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        // позже сделать обработчик ошибок
                    }
                });
            });
        });
    </script>
    <script src="{% static '/script/header_animation.js' %}"></script>
</body>
</html>